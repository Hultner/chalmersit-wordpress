/*
	Javascripts for Chalmers.it
	--------------------------------
	Files: jquery.smoothscroll, jquery.autosize, jquery.tipsy, chalmersit.courses, chalmersit
	Build date: 2013-03-05 23:07
 */

(function(a){function g(c){return c.replace(/(:|\.)/g,"\\$1")}var b=function(c){var e=[],d=false,f=c.dir&&c.dir=="left"?"scrollLeft":"scrollTop";this.each(function(){if(!(this==document||this==window)){var h=a(this);if(h[f]()>0)e.push(this);else{h[f](1);(d=h[f]()>0)&&e.push(this);h[f](0)}}});e.length||this.each(function(){if(this.nodeName==="BODY")e=[this]});if(c.el==="first"&&e.length>1)e=[e[0]];return e};a.fn.extend({scrollable:function(c){return this.pushStack(b.call(this,{dir:c}))},firstScrollable:function(c){return this.pushStack(b.call(this,
{el:"first",dir:c}))},smoothScroll:function(c){c=c||{};var e=a.extend({},a.fn.smoothScroll.defaults,c),d=a.smoothScroll.filterPath(location.pathname);this.unbind("click.smoothscroll").bind("click.smoothscroll",function(f){var h=a(this),i=e.exclude,j=e.excludeWithin,k=0,m=0,l=true,o={},q=location.hostname===this.hostname||!this.hostname,r=e.scrollTarget||(a.smoothScroll.filterPath(this.pathname)||d)===d,s=g(this.hash);if(!e.scrollTarget&&(!q||!r||!s))l=false;else{for(;l&&k<i.length;)if(h.is(g(i[k++])))l=
false;for(;l&&m<j.length;)if(h.closest(j[m++]).length)l=false}if(l){f.preventDefault();a.extend(o,e,{scrollTarget:e.scrollTarget||s,link:this});a.smoothScroll(o)}});return this}});a.smoothScroll=function(c,e){var d,f,h,i;i=0;var j="offset",k="scrollTop",m={};h={};if(typeof c==="number"){d=a.fn.smoothScroll.defaults;h=c}else{d=a.extend({},a.fn.smoothScroll.defaults,c||{});if(d.scrollElement){j="position";d.scrollElement.css("position")=="static"&&d.scrollElement.css("position","relative")}}d=a.extend({link:null},
d);k=d.direction=="left"?"scrollLeft":k;if(d.scrollElement){f=d.scrollElement;i=f[k]()}else f=a("html, body").firstScrollable();d.beforeScroll.call(f,d);h=typeof c==="number"?c:e||a(d.scrollTarget)[j]()&&a(d.scrollTarget)[j]()[d.direction]||0;m[k]=h+i+d.offset;i=d.speed;if(i==="auto"){i=m[k]||f.scrollTop();i/=d.autoCoefficent}h={duration:i,easing:d.easing,complete:function(){d.afterScroll.call(d.link,d)}};if(d.step)h.step=d.step;f.length?f.stop().animate(m,h):d.afterScroll.call(d.link,d)};a.smoothScroll.version=
"@VERSION";a.smoothScroll.filterPath=function(c){return c.replace(/^\//,"").replace(/(index|default).[a-zA-Z]{3,4}$/,"").replace(/\/$/,"")};a.fn.smoothScroll.defaults={exclude:[],excludeWithin:[],offset:0,direction:"top",scrollElement:null,scrollTarget:null,beforeScroll:function(){},afterScroll:function(){},easing:"swing",speed:400,autoCoefficent:2}})(jQuery);
(function(a){var g={className:"autosizejs",append:"",callback:false},b="hidden",c=["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],e,d=a('<textarea tabindex="-1" style="position:absolute; top:-9999px; left:-9999px; right:auto; bottom:auto; border:0; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden;"/>').data("autosize",
true)[0];d.style.lineHeight="99px";a(d).css("lineHeight")==="99px"&&c.push("lineHeight");d.style.lineHeight="";a.fn.autosize=function(f){f=a.extend({},g,f||{});d.parentNode!==document.body&&a(document.body).append(d);return this.each(function(){function h(){e=j;d.className=f.className;a.each(c,function(n,p){d.style[p]=k.css(p)})}function i(){var n,p,t;e!==j&&h();if(!o){o=true;d.value=j.value+f.append;d.style.overflowY=j.style.overflowY;t=parseInt(j.style.height,10);d.style.width=k.width()+"px";d.scrollTop=
0;d.scrollTop=9E4;n=d.scrollTop;if(n>l){n=l;p="scroll"}else if(n<m)n=m;n+=r;j.style.overflowY=p||b;if(t!==n){j.style.height=n+"px";u&&f.callback.call(j)}setTimeout(function(){o=false},1)}}var j=this,k=a(j),m=k.height(),l=parseInt(k.css("maxHeight"),10),o,q,r=0,s=j.value,u=a.isFunction(f.callback);if(!k.data("autosize")){if(k.css("box-sizing")==="border-box"||k.css("-moz-box-sizing")==="border-box"||k.css("-webkit-box-sizing")==="border-box")r=k.outerHeight()-k.height();q=k.css("resize")==="none"?
"none":"horizontal";k.css({overflow:b,overflowY:b,wordWrap:"break-word",resize:q}).data("autosize",true);l=l&&l>0?l:9E4;if("onpropertychange"in j)if("oninput"in j)j.oninput=j.onkeyup=i;else j.onpropertychange=i;else{j.oninput=i;j.value="";j.value=s}a(window).resize(i);k.bind("autosize",i);k.bind("focus",i)}})}})(window.jQuery||window.Zepto);
(function(a){function g(b,c){this.$element=a(b);this.options=c;this.enabled=true;this.fixTitle()}g.prototype={show:function(){var b=this.getTitle();if(b&&this.enabled){var c=this.tip();c.find(".tipsy-inner")[this.options.html?"html":"text"](b);c[0].className="tipsy";c.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).prependTo(document.body);b=a.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight});var e=c[0].offsetWidth,d=c[0].offsetHeight,
f=typeof this.options.gravity=="function"?this.options.gravity.call(this.$element[0]):this.options.gravity,h;switch(f.charAt(0)){case "n":h={top:b.top+b.height+this.options.offset,left:b.left+b.width/2-e/2};break;case "s":h={top:b.top-d-this.options.offset,left:b.left+b.width/2-e/2};break;case "e":h={top:b.top+b.height/2-d/2,left:b.left-e-this.options.offset};break;case "w":h={top:b.top+b.height/2-d/2,left:b.left+b.width+this.options.offset}}if(f.length==2)h.left=f.charAt(1)=="w"?b.left+b.width/2-
15:b.left+b.width/2-e+15;c.css(h).addClass("tipsy-"+f);c.find(".tipsy-arrow")[0].className="tipsy-arrow tipsy-arrow-"+f.charAt(0);this.options.className&&c.addClass(typeof this.options.className=="function"?this.options.className.call(this.$element[0]):this.options.className);this.options.fade?c.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity}):c.css({visibility:"visible",opacity:this.options.opacity})}},hide:function(){this.options.fade?this.tip().stop().fadeOut(function(){a(this).remove()}):
this.tip().remove()},fixTitle:function(){var b=this.$element;if(b.attr("title")||typeof b.attr("original-title")!="string")b.attr("original-title",b.attr("title")||"").removeAttr("title")},getTitle:function(){var b,c=this.$element,e=this.options;this.fixTitle();e=this.options;if(typeof e.title=="string")b=c.attr(e.title=="title"?"original-title":e.title);else if(typeof e.title=="function")b=e.title.call(c[0]);return(b=(""+b).replace(/(^\s*|\s*$)/,""))||e.fallback},tip:function(){if(!this.$tip){this.$tip=
a('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>');this.$tip.data("tipsy-pointee",this.$element[0])}return this.$tip},validate:function(){if(!this.$element[0].parentNode){this.hide();this.options=this.$element=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled}};a.fn.tipsy=function(b){function c(i){var j=a.data(i,"tipsy");if(!j){j=new g(i,a.fn.tipsy.elementOptions(i,
b));a.data(i,"tipsy",j)}return j}function e(){var i=c(this);i.hoverState="in";if(b.delayIn==0)i.show();else{i.fixTitle();setTimeout(function(){i.hoverState=="in"&&i.show()},b.delayIn)}}function d(){var i=c(this);i.hoverState="out";b.delayOut==0?i.hide():setTimeout(function(){i.hoverState=="out"&&i.hide()},b.delayOut)}if(b===true)return this.data("tipsy");else if(typeof b=="string"){var f=this.data("tipsy");f&&f[b]();return this}b=a.extend({},a.fn.tipsy.defaults,b);b.live||this.each(function(){c(this)});
if(b.trigger!="manual"){f=b.live?"live":"bind";var h=b.trigger=="hover"?"mouseleave":"blur";this[f](b.trigger=="hover"?"mouseenter":"focus",e)[f](h,d)}return this};a.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:false,fallback:"",gravity:"n",html:false,live:false,offset:0,opacity:0.8,title:"title",trigger:"hover"};a.fn.tipsy.revalidate=function(){a(".tipsy").each(function(){var b=a.data(this,"tipsy-pointee"),c;if(!(c=!b)){a:{for(b=b;b=b.parentNode;)if(b==document){b=true;break a}b=false}c=
!b}c&&a(this).remove()})};a.fn.tipsy.elementOptions=function(b,c){return a.metadata?a.extend({},c,a(b).metadata()):c};a.fn.tipsy.autoNS=function(){return a(this).offset().top>a(document).scrollTop()+a(window).height()/2?"s":"n"};a.fn.tipsy.autoWE=function(){return a(this).offset().left>a(document).scrollLeft()+a(window).width()/2?"e":"w"};a.fn.tipsy.autoBounds=function(b,c){return function(){var e={ns:c[0],ew:c.length>1?c[1]:false},d=a(document).scrollTop()+b,f=a(document).scrollLeft()+b,h=a(this);
if(h.offset().top<d)e.ns="n";if(h.offset().left<f)e.ew="w";if(a(window).width()+a(document).scrollLeft()-h.offset().left<b)e.ew="e";if(a(window).height()+a(document).scrollTop()-h.offset().top<b)e.ns="s";return e.ns+(e.ew?e.ew:"")}}})(jQuery);
(function(a){if(!window.localStorage)return false;var g=window.localStorage;a.persist={clear:function(){g.removeItem("period");g.removeItem("year")},save:function(b){g.setItem("period",b.period);g.setItem("year",b.year);console.log("Saved: ",b)},load:function(b){var c=g.getItem("year"),e=g.getItem("period");b.year.filter("[value='"+c+"']").attr("checked",true);b.period.filter("[value='"+e+"']").attr("checked",true);b.callback()}};a.fn.persist=function(b){return this.each(function(){var c=a(this).find(b.year),
e=a(this).find(b.period),d=a(b.save),f=a(b.clear);a.persist.load({year:c,period:e,callback:b.callback});c.add(e).on("change",function(h){d.attr("disabled",false);b.callback(h)});d.on("click",function(h){h.preventDefault();a.persist.save({year:parseInt(c.filter(":checked").val()),period:parseInt(e.filter(":checked").val())});f.attr("disabled",false);d.attr("disabled",true)});f.on("click",function(h){h.preventDefault();a.persist.clear();f.attr("disabled",true)})})}})(jQuery);
$(function(){var a=$("#courses-form");a.find("input");var g=$("#courses-container");a.persist({year:"#years-field input",period:"#periods-field input",save:"#save-config",clear:"#clear-config",callback:function(){a.find(".loading").fadeIn();var b={action:"it_courses_filter",year:parseInt(a.find("#years-field input").filter(":checked").val()),period:parseInt(a.find("#periods-field input").filter(":checked").val())};$.get(pageOptions.ajaxURL,b,function(c){a.find(".loading").hide();g.html(c)})}})});
var Chalmers=function(a){a=a||{};a.linkify=function(g){if(g)g=g.replace(/((https?\:\/\/)|(www\.))(\S+)(\w{2,4})(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/gi,function(b){var c=b;c.match("^https?://")||(c="http://"+c);return'<a href="'+c+'">'+b+"</a>"});return g};return a}(window.Chalmers);(function(a){a.fn.jb_animate=function(g){return this.each(function(){a(this).addClass(g).on("webkitAnimationEnd animationend",function(){a(this).removeClass(g)})})}})(jQuery);
(function(a){a.fn.tabs=function(g){if(g.tabContainer===undefined)return false;var b=a(this),c={activeClass:"current",useHash:true,hashPrefix:"tab-",el:"a"};c=a.extend({},c,g);return this.each(function(){var e=a(c.tabContainer),d=location.hash&&"#"+c.hashPrefix+location.hash.replace("#","");d=c.useHash&&d||":first";e.hide().filter(d).show();a(this).find(c.el).on("click",function(f){f.preventDefault();f=e.filter(this.hash);e.hide();f.show();b.find(c.el).removeClass(c.activeClass);a(this).addClass(c.activeClass);
location.hash=f.attr("id").replace(c.hashPrefix,"")});d==":first"?a(this).find(c.el).filter(d).click():a(this).find(c.el).filter('[href="'+d+'"]').click()})}})(jQuery);
(function(a){a.loadMorePosts=function(g){g=a(g);var b=pageOptions.startPage+1,c=pageOptions.maxPages,e=pageOptions.nextLink;g.find("footer").remove();b<=c&&g.append('<div class="post-placeholder-'+b+'"></div>').append('<footer><a href="#" class="btn wide">Fler nyheter</a></footer>');a(".news footer a").on("click",function(d){d.preventDefault();var f=a(this);if(b<=c){f.text("Laddar ...");a(".post-placeholder-"+b).load(e+" [role='article']",function(){b++;e=e.replace(/\/page\/[0-9]?/,"/page/"+b);a(".news > footer").before('<div class="post-placeholder-'+
b+'"></div>');b<=c?f.text("Fler nyheter"):f.text("Inga fler nyheter finns").attr("disabled",true)})}})}})(jQuery);
$(function(){$(".home #login-btn").on("click",function(a){a.preventDefault();$(".user-area form").jb_animate("shake").find("input[type='text']:first").focus()});$(".smooth").smoothScroll({offset:-100});$(".comment-action").smoothScroll({afterScroll:function(){$("#comment").focus()}});$("#comment").on("focus",function(){$(this).next(".comment-submit").show().find("#submit").attr("disabled",true)}).on("input",function(){var a=$(this).val();$(this).next(".comment-submit").find("#submit").attr("disabled",
a==="")});$(".autosize").autosize({append:"\n\n\n"});$.fn.tipsy.elementOptions=function(a,g){return $.extend({},g,{gravity:$(a).data("tooltip-gravity")||"s",offset:parseInt($(a).data("tooltip-offset"))||0})};$('[rel="tooltip"]').tipsy({gravity:"s",offset:5});$("article .article-content img:not(.avatar)").each(function(){$(this).parent().is("figure")&&$(this).parent().addClass("subtle-border")});$(".tabs").tabs({tabContainer:".tab-container > div",activeClass:"tab-current"});$.getJSON("https://api.twitter.com/1/statuses/user_timeline/chalmersit.json?callback=?",
function(a){var g=$("<ul />",{"class":"list"});if(a!=null){$.each(a,function(){var b=new Date(this.created_at);b="<p>"+Chalmers.linkify(this.text)+"</p><time>"+b.toDateString()+"</time>";b=$("<li />",{html:b});g.append(b)});$("#tweet-list").append(g)}else g.html("<li>Kunde inte h\u00e4mta tweets fr\u00e5n Twitter</li>")})});
