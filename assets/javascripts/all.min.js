/*
	Javascripts for Chalmers.it
	--------------------------------
	Files: [jquery.smoothscroll, jquery.autosize, jquery.tipsy, jquery.modal, chalmersit.courses, chalmersit]
	Build date: 2013-03-28 16:14
 */

(function(a){function h(e){return e.replace(/(:|\.)/g,"\\$1")}var b=function(e){var c=[],d=false,f=e.dir&&e.dir=="left"?"scrollLeft":"scrollTop";this.each(function(){if(!(this==document||this==window)){var g=a(this);if(g[f]()>0)c.push(this);else{g[f](1);(d=g[f]()>0)&&c.push(this);g[f](0)}}});c.length||this.each(function(){if(this.nodeName==="BODY")c=[this]});if(e.el==="first"&&c.length>1)c=[c[0]];return c};a.fn.extend({scrollable:function(e){return this.pushStack(b.call(this,{dir:e}))},firstScrollable:function(e){return this.pushStack(b.call(this,
{el:"first",dir:e}))},smoothScroll:function(e){e=e||{};var c=a.extend({},a.fn.smoothScroll.defaults,e),d=a.smoothScroll.filterPath(location.pathname);this.unbind("click.smoothscroll").bind("click.smoothscroll",function(f){var g=a(this),i=c.exclude,j=c.excludeWithin,k=0,m=0,l=true,o={},q=location.hostname===this.hostname||!this.hostname,r=c.scrollTarget||(a.smoothScroll.filterPath(this.pathname)||d)===d,s=h(this.hash);if(!c.scrollTarget&&(!q||!r||!s))l=false;else{for(;l&&k<i.length;)if(g.is(h(i[k++])))l=
false;for(;l&&m<j.length;)if(g.closest(j[m++]).length)l=false}if(l){f.preventDefault();a.extend(o,c,{scrollTarget:c.scrollTarget||s,link:this});a.smoothScroll(o)}});return this}});a.smoothScroll=function(e,c){var d,f,g,i;i=0;var j="offset",k="scrollTop",m={};g={};if(typeof e==="number"){d=a.fn.smoothScroll.defaults;g=e}else{d=a.extend({},a.fn.smoothScroll.defaults,e||{});if(d.scrollElement){j="position";d.scrollElement.css("position")=="static"&&d.scrollElement.css("position","relative")}}d=a.extend({link:null},
d);k=d.direction=="left"?"scrollLeft":k;if(d.scrollElement){f=d.scrollElement;i=f[k]()}else f=a("html, body").firstScrollable();d.beforeScroll.call(f,d);g=typeof e==="number"?e:c||a(d.scrollTarget)[j]()&&a(d.scrollTarget)[j]()[d.direction]||0;m[k]=g+i+d.offset;i=d.speed;if(i==="auto"){i=m[k]||f.scrollTop();i/=d.autoCoefficent}g={duration:i,easing:d.easing,complete:function(){d.afterScroll.call(d.link,d)}};if(d.step)g.step=d.step;f.length?f.stop().animate(m,g):d.afterScroll.call(d.link,d)};a.smoothScroll.version=
"@VERSION";a.smoothScroll.filterPath=function(e){return e.replace(/^\//,"").replace(/(index|default).[a-zA-Z]{3,4}$/,"").replace(/\/$/,"")};a.fn.smoothScroll.defaults={exclude:[],excludeWithin:[],offset:0,direction:"top",scrollElement:null,scrollTarget:null,beforeScroll:function(){},afterScroll:function(){},easing:"swing",speed:400,autoCoefficent:2}})(jQuery);
(function(a){var h={className:"autosizejs",append:"",callback:false},b="hidden",e=["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],c,d=a('<textarea tabindex="-1" style="position:absolute; top:-9999px; left:-9999px; right:auto; bottom:auto; border:0; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden;"/>').data("autosize",
true)[0];d.style.lineHeight="99px";a(d).css("lineHeight")==="99px"&&e.push("lineHeight");d.style.lineHeight="";a.fn.autosize=function(f){f=a.extend({},h,f||{});d.parentNode!==document.body&&a(document.body).append(d);return this.each(function(){function g(){c=j;d.className=f.className;a.each(e,function(n,p){d.style[p]=k.css(p)})}function i(){var n,p,t;c!==j&&g();if(!o){o=true;d.value=j.value+f.append;d.style.overflowY=j.style.overflowY;t=parseInt(j.style.height,10);d.style.width=k.width()+"px";d.scrollTop=
0;d.scrollTop=9E4;n=d.scrollTop;if(n>l){n=l;p="scroll"}else if(n<m)n=m;n+=r;j.style.overflowY=p||b;if(t!==n){j.style.height=n+"px";u&&f.callback.call(j)}setTimeout(function(){o=false},1)}}var j=this,k=a(j),m=k.height(),l=parseInt(k.css("maxHeight"),10),o,q,r=0,s=j.value,u=a.isFunction(f.callback);if(!k.data("autosize")){if(k.css("box-sizing")==="border-box"||k.css("-moz-box-sizing")==="border-box"||k.css("-webkit-box-sizing")==="border-box")r=k.outerHeight()-k.height();q=k.css("resize")==="none"?
"none":"horizontal";k.css({overflow:b,overflowY:b,wordWrap:"break-word",resize:q}).data("autosize",true);l=l&&l>0?l:9E4;if("onpropertychange"in j)if("oninput"in j)j.oninput=j.onkeyup=i;else j.onpropertychange=i;else{j.oninput=i;j.value="";j.value=s}a(window).resize(i);k.bind("autosize",i);k.bind("focus",i)}})}})(window.jQuery||window.Zepto);
(function(a){function h(b,e){this.$element=a(b);this.options=e;this.enabled=true;this.fixTitle()}h.prototype={show:function(){var b=this.getTitle();if(b&&this.enabled){var e=this.tip();e.find(".tipsy-inner")[this.options.html?"html":"text"](b);e[0].className="tipsy";e.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).prependTo(document.body);b=a.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight});var c=e[0].offsetWidth,d=e[0].offsetHeight,
f=typeof this.options.gravity=="function"?this.options.gravity.call(this.$element[0]):this.options.gravity,g;switch(f.charAt(0)){case "n":g={top:b.top+b.height+this.options.offset,left:b.left+b.width/2-c/2};break;case "s":g={top:b.top-d-this.options.offset,left:b.left+b.width/2-c/2};break;case "e":g={top:b.top+b.height/2-d/2,left:b.left-c-this.options.offset};break;case "w":g={top:b.top+b.height/2-d/2,left:b.left+b.width+this.options.offset}}if(f.length==2)g.left=f.charAt(1)=="w"?b.left+b.width/2-
15:b.left+b.width/2-c+15;e.css(g).addClass("tipsy-"+f);e.find(".tipsy-arrow")[0].className="tipsy-arrow tipsy-arrow-"+f.charAt(0);this.options.className&&e.addClass(typeof this.options.className=="function"?this.options.className.call(this.$element[0]):this.options.className);this.options.fade?e.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity}):e.css({visibility:"visible",opacity:this.options.opacity})}},hide:function(){this.options.fade?this.tip().stop().fadeOut(function(){a(this).remove()}):
this.tip().remove()},fixTitle:function(){var b=this.$element;if(b.attr("title")||typeof b.attr("original-title")!="string")b.attr("original-title",b.attr("title")||"").removeAttr("title")},getTitle:function(){var b,e=this.$element,c=this.options;this.fixTitle();c=this.options;if(typeof c.title=="string")b=e.attr(c.title=="title"?"original-title":c.title);else if(typeof c.title=="function")b=c.title.call(e[0]);return(b=(""+b).replace(/(^\s*|\s*$)/,""))||c.fallback},tip:function(){if(!this.$tip){this.$tip=
a('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>');this.$tip.data("tipsy-pointee",this.$element[0])}return this.$tip},validate:function(){if(!this.$element[0].parentNode){this.hide();this.options=this.$element=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled}};a.fn.tipsy=function(b){function e(i){var j=a.data(i,"tipsy");if(!j){j=new h(i,a.fn.tipsy.elementOptions(i,
b));a.data(i,"tipsy",j)}return j}function c(){var i=e(this);i.hoverState="in";if(b.delayIn==0)i.show();else{i.fixTitle();setTimeout(function(){i.hoverState=="in"&&i.show()},b.delayIn)}}function d(){var i=e(this);i.hoverState="out";b.delayOut==0?i.hide():setTimeout(function(){i.hoverState=="out"&&i.hide()},b.delayOut)}if(b===true)return this.data("tipsy");else if(typeof b=="string"){var f=this.data("tipsy");f&&f[b]();return this}b=a.extend({},a.fn.tipsy.defaults,b);b.live||this.each(function(){e(this)});
if(b.trigger!="manual"){f=b.live?"live":"bind";var g=b.trigger=="hover"?"mouseleave":"blur";this[f](b.trigger=="hover"?"mouseenter":"focus",c)[f](g,d)}return this};a.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:false,fallback:"",gravity:"n",html:false,live:false,offset:0,opacity:0.8,title:"title",trigger:"hover"};a.fn.tipsy.revalidate=function(){a(".tipsy").each(function(){var b=a.data(this,"tipsy-pointee"),e;if(!(e=!b)){a:{for(b=b;b=b.parentNode;)if(b==document){b=true;break a}b=false}e=
!b}e&&a(this).remove()})};a.fn.tipsy.elementOptions=function(b,e){return a.metadata?a.extend({},e,a(b).metadata()):e};a.fn.tipsy.autoNS=function(){return a(this).offset().top>a(document).scrollTop()+a(window).height()/2?"s":"n"};a.fn.tipsy.autoWE=function(){return a(this).offset().left>a(document).scrollLeft()+a(window).width()/2?"e":"w"};a.fn.tipsy.autoBounds=function(b,e){return function(){var c={ns:e[0],ew:e.length>1?e[1]:false},d=a(document).scrollTop()+b,f=a(document).scrollLeft()+b,g=a(this);
if(g.offset().top<d)c.ns="n";if(g.offset().left<f)c.ew="w";if(a(window).width()+a(document).scrollLeft()-g.offset().left<b)c.ew="e";if(a(window).height()+a(document).scrollTop()-g.offset().top<b)c.ns="s";return c.ns+(c.ew?c.ew:"")}}})(jQuery);
(function(a){var h=function(c,d){this.options=d;this.$element=a(c).delegate('[data-dismiss="modal"]',"click.dismiss.modal",a.proxy(this.hide,this));this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};h.prototype={constructor:h,toggle:function(){return this[!this.isShown?"show":"hide"]()},show:function(){var c=this,d=a.Event("show");this.$element.trigger(d);if(!(this.isShown||d.isDefaultPrevented())){this.isShown=true;this.escape();this.backdrop(function(){var f=a.support.transition&&
c.$element.hasClass("fade");c.$element.parent().length||c.$element.appendTo(document.body);c.$element.show();c.$element.addClass("in").attr("aria-hidden",false);c.enforceFocus();f?c.$element.one(a.support.transition.end,function(){c.$element.focus().trigger("shown")}):c.$element.focus().trigger("shown")})}},hide:function(c){c&&c.preventDefault();c=a.Event("hide");this.$element.trigger(c);if(!(!this.isShown||c.isDefaultPrevented())){this.isShown=false;this.escape();a(document).off("focusin.modal");
this.$element.removeClass("in").attr("aria-hidden",true);a.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal()}},enforceFocus:function(){var c=this;a(document).on("focusin.modal",function(d){c.$element[0]!==d.target&&!c.$element.has(d.target).length&&c.$element.focus()})},escape:function(){var c=this;if(this.isShown&&this.options.keyboard)this.$element.on("keyup.dismiss.modal",function(d){d.which==27&&c.hide()});else this.isShown||this.$element.off("keyup.dismiss.modal")},
hideWithTransition:function(){var c=this,d=setTimeout(function(){c.$element.off(a.support.transition.end);c.hideModal()},500);this.$element.one(a.support.transition.end,function(){clearTimeout(d);c.hideModal()})},hideModal:function(){var c=this;this.$element.hide();this.backdrop(function(){c.removeBackdrop();c.$element.trigger("hidden")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove();this.$backdrop=null},backdrop:function(c){var d=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&
this.options.backdrop){var f=a.support.transition&&d;this.$backdrop=a('<div class="modal-backdrop '+d+'" />').appendTo(document.body);this.$backdrop.click(this.options.backdrop=="static"?a.proxy(this.$element[0].focus,this.$element[0]):a.proxy(this.hide,this));this.$backdrop.addClass("in");console.log("hejs");if(c)f?this.$backdrop.one(a.support.transition.end,c):c()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(a.support.transition.end,
c):c()}else c&&c()}};var b=a.fn.modal;a.fn.modal=function(c){return this.each(function(){var d=a(this),f=d.data("modal"),g=a.extend({},a.fn.modal.defaults,d.data(),typeof c=="object"&&c);f||d.data("modal",f=new h(this,g));if(typeof c=="string")f[c]();else g.show&&f.show()})};a.fn.modal.defaults={backdrop:true,keyboard:true,show:true};a.fn.modal.Constructor=h;a.fn.modal.noConflict=function(){a.fn.modal=b;return this};a(document).on("click.modal.data-api",'[data-toggle="modal"]',function(c){var d=a(this),
f=d.attr("href"),g=a(d.attr("data-target")||f&&f.replace(/.*(?=#[^\s]+$)/,""));f=g.data("modal")?"toggle":a.extend({remote:!/#/.test(f)&&f},g.data(),d.data());c.preventDefault();g.modal(f).one("hide",function(){d.focus()})});var e=a(document.body).on("shown",".modal",function(){e.addClass("modal-open")}).on("hidden",".modal",function(){e.removeClass("modal-open")})})(window.jQuery);
(function(a){if(!window.localStorage)return false;var h=window.localStorage;a.persist={clear:function(){h.removeItem("period");h.removeItem("year")},save:function(b){h.setItem("period",b.period);h.setItem("year",b.year);console.log("Saved: ",b)},load:function(b){var e=h.getItem("year"),c=h.getItem("period");b.year.filter("[value='"+e+"']").attr("checked",true);b.period.filter("[value='"+c+"']").attr("checked",true);b.callback()}};a.fn.persist=function(b){return this.each(function(){var e=a(this).find(b.year),
c=a(this).find(b.period),d=a(b.save),f=a(b.clear);a.persist.load({year:e,period:c,callback:b.callback});e.add(c).on("change",function(g){d.attr("disabled",false);b.callback(g)});d.on("click",function(g){g.preventDefault();a.persist.save({year:parseInt(e.filter(":checked").val()),period:parseInt(c.filter(":checked").val())});f.attr("disabled",false);d.attr("disabled",true)});f.on("click",function(g){g.preventDefault();a.persist.clear();f.attr("disabled",true)})})}})(jQuery);
$(function(){var a=$("#courses-form");a.find("input");var h=$("#courses-container");a.persist({year:"#years-field input",period:"#periods-field input",save:"#save-config",clear:"#clear-config",callback:function(){a.find(".loading").fadeIn();var b={action:"it_courses_filter",year:parseInt(a.find("#years-field input").filter(":checked").val()),period:parseInt(a.find("#periods-field input").filter(":checked").val())};$.get(pageOptions.ajaxURL,b,function(e){a.find(".loading").hide();h.html(e)})}})});
var Chalmers=function(a){a=a||{};a.linkify=function(h){if(h)h=h.replace(/((https?\:\/\/)|(www\.))(\S+)(\w{2,4})(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/gi,function(b){var e=b;e.match("^https?://")||(e="http://"+e);return'<a href="'+e+'">'+b+"</a>"});return h};return a}(window.Chalmers);(function(a){a.fn.jb_animate=function(h){return this.each(function(){a(this).addClass(h).on("webkitAnimationEnd animationend",function(){a(this).removeClass(h)})})}})(jQuery);
(function(a){a.fn.tabs=function(h){if(h.tabContainer===undefined)return false;var b=a(this),e={activeClass:"current",useHash:true,hashPrefix:"tab-",el:"a"};e=a.extend({},e,h);return this.each(function(){var c=a(e.tabContainer),d=location.hash&&"#"+e.hashPrefix+location.hash.replace("#","");d=e.useHash&&d||":first";c.hide().filter(d).show();a(this).find(e.el).on("click",function(f){f.preventDefault();f=c.filter(this.hash);c.hide();f.show();b.find(e.el).removeClass(e.activeClass);a(this).addClass(e.activeClass);
location.hash=f.attr("id").replace(e.hashPrefix,"")});d==":first"?a(this).find(e.el).filter(d).click():a(this).find(e.el).filter('[href="'+d+'"]').click()})}})(jQuery);
(function(a){a.loadMorePosts=function(h){h=a(h);var b=pageOptions.startPage+1,e=pageOptions.maxPages,c=pageOptions.nextLink;h.find("footer").remove();b<=e&&h.append('<div class="post-placeholder-'+b+'"></div>').append('<footer><a href="#" class="btn wide">Fler nyheter</a></footer>');a(".news footer a").on("click",function(d){d.preventDefault();var f=a(this);if(b<=e){f.text("Laddar ...");a(".post-placeholder-"+b).load(c+" [role='article']",function(){b++;c=c.replace(/\/page\/[0-9]?/,"/page/"+b);a(".news > footer").before('<div class="post-placeholder-'+
b+'"></div>');b<=e?f.text("Fler nyheter"):f.text("Inga fler nyheter finns").attr("disabled",true)})}})}})(jQuery);
$(function(){$(".home #login-btn").on("click",function(a){a.preventDefault();$(".user-area form").jb_animate("shake").find("input[type='text']:first").focus()});$("#user-avatar-link").on("click",function(a){a.preventDefault();a=$("<iframe />",{src:this.href,scrolling:"no",id:"avatar-iframe",frameborder:"no",allowTransparency:"true"});$("#avatar-modal").append(a).modal("show")});$("#avatar-modal").on("hidden",function(){$(this).find("iframe").remove()});$("#avatar-iframe").contents().find("#user-avatar-step3-close").removeAttr("onclick").live("click",
function(a){a.preventDefault();$("#avatar-modal").hide()});$(".smooth").smoothScroll({offset:-100});$(".comment-action").smoothScroll({afterScroll:function(){$("#comment").focus()}});$("#comment").on("focus",function(){$(this).next(".comment-submit").show().find("#submit").attr("disabled",true)}).on("input",function(){var a=$(this).val();$(this).next(".comment-submit").find("#submit").attr("disabled",a==="")});$(".autosize").autosize({append:"\n\n\n"});$.fn.tipsy.elementOptions=function(a,h){return $.extend({},
h,{gravity:$(a).data("tooltip-gravity")||"s",offset:parseInt($(a).data("tooltip-offset"))||0})};$('[rel="tooltip"]').tipsy({gravity:"s",offset:5});$("article .article-content img:not(.avatar)").each(function(){$(this).parent().is("figure")&&$(this).parent().addClass("subtle-border")});$(".tabs").tabs({tabContainer:".tab-container > div",activeClass:"tab-current"});$.getJSON("https://api.twitter.com/1/statuses/user_timeline/chalmersit.json?callback=?",function(a){var h=$("<ul />",{"class":"list"});
if(a!=null){$.each(a,function(){var b=new Date(this.created_at);b="<p>"+Chalmers.linkify(this.text)+"</p><time>"+b.toDateString()+"</time>";b=$("<li />",{html:b});h.append(b)});$("#tweet-list").append(h)}else h.html("<li>Kunde inte h\u00e4mta tweets fr\u00e5n Twitter</li>")})});
